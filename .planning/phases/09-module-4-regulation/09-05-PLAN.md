---
phase: 09-module-4-regulation
plan: 05
type: execute
wave: 3
depends_on: ["09-01"]
files_modified:
  - src/components/visualizations/diagrams/ShadowBankingComparison.tsx
  - src/components/visualizations/diagrams/MoneyMarketRunChart.tsx
  - src/components/visualizations/diagrams/index.ts
autonomous: true
---

<objective>
Build two visualization components for Lessons 4-3.2 and 4-3.3: Shadow Banking Comparison and Money Market Fund Run Chart.

Purpose: Create interactive visualizations for shadow banking concepts and the money market fund crisis case study.
Output: Two new diagram components registered in the visualizations barrel export.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

@src/components/visualizations/diagrams/BankBalanceSheetDetailed.tsx
@src/components/visualizations/diagrams/OffBalanceSheetIceberg.tsx
@src/components/visualizations/diagrams/index.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create ShadowBankingComparison component</name>
  <files>src/components/visualizations/diagrams/ShadowBankingComparison.tsx</files>
  <action>
  Create an interactive side-by-side comparison of traditional banks vs shadow banks.

  Design: Split comparison layout with toggle interactions.

  **Main Comparison Panel:**
  Two columns side by side:

  Left — Traditional Bank:
  - Balance sheet visual:
    - Assets: Loans (illiquid, long-term)
    - Liabilities: Deposits (demand, short-term)
  - Regulation icons: ✅ FDIC insured, ✅ Fed LOLR, ✅ Capital requirements, ✅ Supervision
  - Color: blue/primary theme (safe, regulated)

  Right — Shadow Bank:
  - Balance sheet visual:
    - Assets: MBS, loan funds (illiquid)
    - Liabilities: Repos, money market shares (demand-like)
  - Regulation icons: ❌ No FDIC, ❌ No LOLR, ❌ Weak capital rules, ❌ Limited oversight
  - Color: amber/warning theme (risky, less regulated)

  Shared bottom: "Same function, different regulation" callout

  **Why Shadow Banks Exist — Toggle:**
  Two-tab toggle (like existing toggle patterns):
  - "Efficiency View": Specialized, cheaper, more flexible
  - "Regulatory Arbitrage View": Same service + less regulation = lower cost = competitive advantage
  - Show formula: Bank profit − Regulation cost vs Shadow profit − Lower regulation cost

  **What Is NOT Shadow Banking — Expandable:**
  - Insurance companies: long assets + long liabilities = no run risk
  - Explanation: "No demand withdrawal risk → no bank-like fragility"

  **Key Shadow Institutions — Expandable cards:**
  - Money Market Funds: deposit-like shares + short-term debt
  - Repo Market: collateralized short-term lending like deposits
  - MBS Vehicles: mortgage pools funding via short-term paper

  Follow existing balance sheet visual patterns (BankBalanceSheetDetailed). Use glass morphism, toggle pattern, expandable sections.
  </action>
  <verify>npm run build succeeds without errors</verify>
  <done>ShadowBankingComparison renders bank vs shadow bank side-by-side with regulatory differences, toggle views, and expandable institution cards.</done>
</task>

<task type="auto">
  <name>Task 2: Create MoneyMarketRunChart component</name>
  <files>src/components/visualizations/diagrams/MoneyMarketRunChart.tsx, src/components/visualizations/diagrams/index.ts</files>
  <action>
  Create an interactive visualization of the money market fund crisis (2008 and 2020).

  Design: Multi-section narrative visualization.

  **Section 1 — The Run (animated chart):**
  - SVG line/area chart showing money market fund assets over time
  - Approximate data:
    - Pre-crisis: ~$3.5 trillion
    - Post-Lehman (Sep 2008): drop ~30% to ~$2.5 trillion
    - Recovery with government guarantee
  - Animate the cliff-like drop
  - Mark "Lehman collapse" and "Government guarantee (Sep 19)" on chart
  - Color: from blue to red as assets drop

  **Section 2 — What Happened (step animation):**
  - Step-by-step animated flow (like LiquidityCrisisFlow pattern):
    1. Some funds held Lehman debt
    2. Lehman collapses → funds take losses
    3. Losses disclosed → investor panic
    4. Mass withdrawals across industry (−30%)
    5. Forced asset sales at discount
    6. Government steps in: guarantee + Fed lending
    7. Losses = 0 for investors
  - Each step appears with stagger, clickable for detail

  **Section 3 — Post-Crisis Reforms:**
  Three reform cards with toggle to show if they worked:
  - Floating NAV: "Share value can fluctuate instead of fixed $1" → Reduces deposit illusion
  - Liquidity Fees: "Fees on withdrawals during stress" → Penalty for running
  - Redemption Gates: "Temporary freeze on withdrawals up to 10 days" → Stops run

  **Section 4 — 2020 COVID: "Rules Failed Again"**
  - Brief timeline: March 2020 → another run → another Fed bailout
  - Key insight card: "Preemptive Run Incentive"
    - Gates/fees make investors run EARLIER to avoid being locked out
    - Logic: "Withdraw now or be trapped tomorrow"
    - This is a paradox: tools designed to stop runs → accelerate runs

  Follow existing step-animation patterns (LiquidityCrisisFlow). Use glass morphism, spring animations.

  **Update diagrams/index.ts:**
  Add exports for ShadowBankingComparison and MoneyMarketRunChart.
  </action>
  <verify>npm run build succeeds without errors</verify>
  <done>MoneyMarketRunChart renders crisis asset chart, step-by-step narrative, reform cards with effectiveness toggle, and 2020 repeat. Both exported from diagrams/index.ts.</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] npm run build succeeds
- [ ] ShadowBankingComparison renders bank vs shadow comparison
- [ ] MoneyMarketRunChart renders crisis narrative with reforms
- [ ] Both components exported from diagrams/index.ts
</verification>

<success_criteria>
- All tasks completed
- Both visualization components working
- Shadow banking comparison clearly shows regulatory gap
- Money market chart tells the crisis story interactively
</success_criteria>

<output>
After completion, create `.planning/phases/09-module-4-regulation/09-05-SUMMARY.md`
</output>
