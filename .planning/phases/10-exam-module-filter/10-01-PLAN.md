---
phase: 10-exam-module-filter
plan: 01
type: execute
wave: 1
depends_on: []
files_modified: [src/data/examQuestions.ts, src/components/study-tools/ExamSetup.tsx, src/app/study-tools/exam/page.tsx]
autonomous: false
---

<objective>
Add module selection to the exam practice setup screen so users can filter questions by module.

Purpose: Let students focus practice on specific modules (e.g., only Module 4, or modules 1-4) instead of always drawing from all modules.
Output: Updated exam setup with module filter toggle chips, updated generateExam to accept module filter.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
@~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

@src/data/examQuestions.ts
@src/components/study-tools/ExamSetup.tsx
@src/app/study-tools/exam/page.tsx
@src/data/modules.ts
@src/types/index.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add module filter to generateExam and ExamSetup</name>
  <files>src/data/examQuestions.ts, src/components/study-tools/ExamSetup.tsx, src/app/study-tools/exam/page.tsx</files>
  <action>
  **1. Update `generateExam` in `src/data/examQuestions.ts`:**
  - Add optional parameter `moduleIds?: number[]` to `generateExam` function
  - If `moduleIds` is provided (non-empty array), filter `examQuestions` to only those with matching `moduleId` before applying difficulty distribution
  - If `moduleIds` is undefined/empty, use all questions (current behavior)
  - Also add a helper: `export function getModulesWithQuestions(): number[]` that returns the unique sorted moduleIds from `examQuestions` (currently [1, 2, 3, 4])
  - Also add: `export function getQuestionCountForModules(moduleIds: number[]): number` that returns how many questions match those modules

  **2. Update `ExamSetup` in `src/components/study-tools/ExamSetup.tsx`:**
  - Add `selectedModules` state (type `number[]`, default: all modules with questions)
  - Import `modules` from `@/data/modules` for module titles/icons
  - Import `getModulesWithQuestions`, `getQuestionCountForModules` from `@/data/examQuestions`
  - Add a "Select Modules" section between the header and "How many questions?" section
  - Render toggle chips for each module that has questions. Each chip shows the module icon + short title (e.g., "ðŸ’° Module 1"). Use the same glass morphism button style as question count buttons.
  - Active chips: border color `var(--color-primary)`, subtle primary background tint
  - Inactive chips: default border, no tint
  - Clicking a chip toggles that module. Prevent deselecting ALL modules (at least 1 must remain selected)
  - Add preset buttons below module chips: "All" (selects all), "Modules 1-4" (selects 1-4 â€” same as all currently, but future-proof). These are small text links, not full buttons.
  - Update the `totalQuestions` display to show filtered count based on selected modules
  - Change `onStart` prop type from `(count: 5 | 10 | 15 | 20) => void` to `(count: 5 | 10 | 15 | 20, moduleIds: number[]) => void`
  - Pass `selectedModules` when calling `onStart`
  - If selected modules have fewer questions than the chosen count, cap the count options accordingly (disable buttons where count > available questions)

  **3. Update `ExamPage` in `src/app/study-tools/exam/page.tsx`:**
  - Update `handleStart` to accept `moduleIds: number[]` as second parameter
  - Pass `moduleIds` to `generateExam(count, moduleIds)`

  **Style guidelines:**
  - Follow existing glass morphism pattern (var(--color-glass-light), var(--color-glass-border))
  - Use motion from 'motion/react' for staggered chip animations (same pattern as question count buttons)
  - Module chips should be smaller than question count buttons (padding: 0.5rem 1rem, fontSize: 0.9rem)
  - Keep responsive â€” chips should wrap on mobile
  - Use `display: flex, flexWrap: wrap, gap: 0.5rem, justifyContent: center` for chip layout
  </action>
  <verify>npx tsc --noEmit passes with no errors</verify>
  <done>
  - generateExam accepts optional moduleIds filter
  - ExamSetup shows module toggle chips
  - Selecting/deselecting modules updates available question count
  - Question count buttons disabled when count > available questions
  - At least one module must stay selected
  - ExamPage passes selected modules through to generateExam
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Module filter on exam setup screen â€” toggle chips for each module, preset buttons, dynamic question count</what-built>
  <how-to-verify>
    1. Run: npm run dev (or use existing dev server)
    2. Visit: http://localhost:3000/study-tools/exam (or port 3004)
    3. Verify: Module chips appear between header and question count
    4. Test: Click Module 1 chip to deselect it â€” available question count should drop from 40 to 30
    5. Test: Try to deselect all modules â€” last one should stay selected
    6. Test: Select only Module 4 (10 questions) â€” "15" and "20" count buttons should be disabled
    7. Test: Click "All" preset â€” all modules reselect
    8. Test: Start a quiz with only Module 1 selected â€” all questions should be from Module 1
    9. Test: Dark mode toggle â€” chips render correctly in both themes
    10. Test: Mobile responsive (resize to 375px) â€” chips wrap properly
  </how-to-verify>
  <resume-signal>Type "approved" to continue, or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] npx tsc --noEmit succeeds
- [ ] npm run build succeeds
- [ ] Module filter works visually
- [ ] Questions correctly filtered by selected modules
- [ ] Dark mode works
- [ ] Mobile responsive
</verification>

<success_criteria>
- All tasks completed
- User approved visual verification
- Module filter integrated into exam flow
- No regressions to existing exam functionality
</success_criteria>

<output>
After completion, create `.planning/phases/10-exam-module-filter/10-01-SUMMARY.md`
</output>
