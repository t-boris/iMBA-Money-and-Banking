---
phase: 09-module-4-regulation
plan: 07
type: execute
wave: 5
depends_on: ["09-01", "09-02", "09-03", "09-04", "09-05", "09-06"]
files_modified:
  - src/components/modules/Module4Content.tsx
  - src/components/modules/index.ts
  - src/app/modules/[slug]/page.tsx
autonomous: true
---

<objective>
Create Module4Content component integrating all visualizations into a lesson-based navigation structure, and wire it into the module page.

Purpose: Assemble all Module 4 visualizations into a navigable content experience following the established pattern.
Output: Complete Module 4 content page with lesson navigation and all visualizations.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

@src/components/modules/Module3Content.tsx
@src/components/modules/index.ts
@src/app/modules/[slug]/page.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Module4Content component</name>
  <files>src/components/modules/Module4Content.tsx</files>
  <action>
  Create Module4Content.tsx following the EXACT pattern of Module3Content.tsx.

  Structure:
  - 'use client' directive
  - Import useState, useEffect from react
  - Import motion, AnimatePresence from @/lib/motion
  - Import module4Lessons from @/data/module4
  - Import LessonNav from ./LessonNav
  - Import all visualization components from @/components/visualizations
  - Import cn from @/lib/utils

  State management:
  - activeLesson state (default: '4-0')
  - direction state for animation
  - getLessonIndex helper
  - handleLessonChange with direction tracking
  - URL hash navigation (e.g., #lesson-4-1.1)
  - Scroll to top on lesson change

  Lesson content mapping — Record<string, LessonContentConfig> with all 13 lessons:

  '4-0': Overview
    - description: "This module explores why banks are among the most regulated institutions, how the regulatory framework works, and the modern challenges regulators face — from too-big-to-fail to shadow banking."
    - visualizations: [<RegulationOverviewFlow />]

  '4-1': Understanding Bank Regulation
    - description: "Regulation exists because bank failures create negative externalities — spillover costs that individual banks don't internalize. The challenge is balancing stability with efficiency."
    - visualizations: [] (parent section intro)

  '4-1.1': Goals of Financial Regulation
    - description: "Banks create value through credit and payments, but their failure imposes costs on society. Regulation addresses market failures through microprudential (individual bank) and macroprudential (system-wide) approaches."
    - visualizations: [<ExternalityDiagram />]

  '4-1.2': Government Safety Net
    - description: "Banks are inherently fragile due to liquidity mismatch. The government safety net — deposit insurance and lender of last resort — prevents and stops bank runs, but creates moral hazard."
    - visualizations: [<SafetyNetFlow />, <ContagionNetwork />]

  '4-1.3': Crisis Interventions 2007-2009
    - description: "The 2007-2009 crisis saw dramatic expansion of the safety net: increased deposit insurance limits, emergency lending facilities, and the TARP bailout program."
    - visualizations: [<TEDSpreadTimeline />]

  '4-2': Regulation and Supervision in Practice
    - description: "Bank regulation means formal rules. Bank supervision means ongoing enforcement. Together they ensure safety and soundness of the banking system."
    - visualizations: [] (parent section intro)

  '4-2.1': Bank Regulation Rules
    - description: "Regulators control bank entry, activities, funding, and require disclosure. The Basel Accord sets global minimum capital standards using risk-weighted assets to prevent a regulatory race to the bottom."
    - visualizations: [<CapitalRequirementsCalculator />]

  '4-2.2': Supervisory Process
    - description: "Supervisors monitor banks through offsite reports and onsite examinations, rate them using CAMELS, and enforce corrections through penalties and restrictions."
    - visualizations: [<SupervisoryProcessFlow />, <CAMELSRadar />]

  '4-2.3': Stress Testing
    - description: "Stress tests force banks to plan for severe economic scenarios. The Fed's annual CCAR tests determine whether large banks have enough capital to survive a crisis."
    - visualizations: [<StressTestSimulator />]

  '4-3': 21st Century Challenges
    - description: "Modern regulators face new challenges: banks too big to fail, shadow banking outside traditional regulation, and repeated crises despite reforms."
    - visualizations: [] (parent section intro)

  '4-3.1': Too Big to Fail
    - description: "A small number of megabanks hold most banking assets. Their failure would threaten the entire system, creating an implicit government guarantee that encourages risk-taking."
    - visualizations: [<TBTFConcentration />]

  '4-3.2': Shadow Banking
    - description: "Shadow banks perform bank-like functions — illiquid assets funded by demand-like liabilities — but operate outside traditional bank regulation, creating hidden systemic risk."
    - visualizations: [<ShadowBankingComparison />]

  '4-3.3': Money Market Funds Case Study
    - description: "Money market funds experienced bank-like runs in 2008 and 2020, received government bailouts despite not being banks, and post-crisis reforms paradoxically may accelerate future runs."
    - visualizations: [<MoneyMarketRunChart />]

  Animation variants — SAME as Module3Content:
  - contentVariants with enter/center/exit for direction-aware slide
  - Transition with spring physics

  Render structure — SAME as Module3Content:
  - LessonNav at top
  - AnimatePresence with motion.div for content
  - Title, description, visualization grid
  - cn() for className merging
  </action>
  <verify>npm run build succeeds without errors</verify>
  <done>Module4Content renders all 13 lessons with lesson navigation, animations, and all 11 visualization components properly mapped.</done>
</task>

<task type="auto">
  <name>Task 2: Wire Module4Content into the module page</name>
  <files>src/components/modules/index.ts, src/app/modules/[slug]/page.tsx</files>
  <action>
  1. In src/components/modules/index.ts, add:
     `export { Module4Content } from './Module4Content';`

  2. In src/app/modules/[slug]/page.tsx:
     - Add Module4Content to the import from '@/components/modules'
     - In the content section, add a new condition for module 4:
       ```
       currentModule.id === 4 ? (
         <Module4Content />
       ) :
       ```
     - Place it after the Module3Content condition and before the "Coming Soon" fallback
  </action>
  <verify>npm run build succeeds. Navigate to /modules/regulation and verify content renders.</verify>
  <done>Module 4 accessible at /modules/regulation with full lesson navigation and all visualizations.</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] npm run build succeeds
- [ ] Module4Content renders without errors
- [ ] All 13 lessons navigable via LessonNav
- [ ] All 11 visualization components render in correct lessons
- [ ] URL hash navigation works (e.g., #lesson-4-2.1)
- [ ] Direction-aware slide animations working
</verification>

<success_criteria>
- All tasks completed
- Module 4 content page fully functional
- All visualizations render in correct lessons
- Navigation works identically to Module 3
</success_criteria>

<output>
After completion, create `.planning/phases/09-module-4-regulation/09-07-SUMMARY.md`
</output>
