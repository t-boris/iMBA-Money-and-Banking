---
phase: 04-module-1-content
plan: 06
type: execute
wave: 3
depends_on: ["04-01", "04-02"]
files_modified: [src/components/visualizations/diagrams/DirectIndirectFinance.tsx, src/components/visualizations/diagrams/BankBalanceSheet.tsx, src/components/visualizations/diagrams/index.ts]
autonomous: true
---

<objective>
Build Direct vs Indirect Finance paths and Bank Balance Sheet visualizations.

Purpose: Create diagrams that explain how finance flows directly through markets vs indirectly through institutions, and an interactive bank balance sheet showing assets/liabilities.
Output: Two key visualizations for Lesson 1-2.2 and 1-2.3 (Financial Markets vs Institutions, Banks).
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-module-1-content/04-CONTEXT.md

@src/components/visualizations/index.ts
@src/components/visualizations/Entity.tsx
@src/components/visualizations/FlowArrow.tsx
@src/lib/motion.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create DirectIndirectFinance comparison visualization</name>
  <files>src/components/visualizations/diagrams/DirectIndirectFinance.tsx</files>
  <action>
Create a side-by-side comparison showing direct vs indirect finance:

```typescript
'use client';

import { useState } from 'react';
import { motion } from '@/lib/motion';
import { Entity, FlowArrow } from '@/components/visualizations';
import { cn } from '@/lib/utils';

interface DirectIndirectFinanceProps {
  className?: string;
  initialView?: 'direct' | 'indirect' | 'both';
}

export function DirectIndirectFinance({ className, initialView = 'both' }: DirectIndirectFinanceProps) {
  const [activeView, setActiveView] = useState<'direct' | 'indirect' | 'both'>(initialView);
  // ...
}
```

Layout (two parallel paths):
```
┌─────────────────────────────────────────────────────────┐
│  How do funds flow from savers to borrowers?            │
├────────────────────────┬────────────────────────────────┤
│   DIRECT FINANCE       │     INDIRECT FINANCE           │
│   (Through Markets)    │     (Through Institutions)     │
├────────────────────────┼────────────────────────────────┤
│                        │                                │
│   [Investor]           │     [Saver]                    │
│       │                │         │                      │
│       ▼                │         ▼                      │
│   [Broker/            │     [Bank/                     │
│    Dealer]            │      Institution]              │
│       │                │         │                      │
│       ▼                │    (Balance Sheet)             │
│   [Another             │         │                      │
│    Investor]           │         ▼                      │
│                        │     [Borrower]                 │
├────────────────────────┼────────────────────────────────┤
│ No balance sheet       │ Institution holds assets       │
│ Just connects parties  │ Transforms: maturity, risk     │
└────────────────────────┴────────────────────────────────┘
```

Features:
1. **Toggle view** (tabs or buttons):
   - "Direct" - shows only direct finance path
   - "Indirect" - shows only indirect path
   - "Both" - side-by-side comparison (default)

2. **Direct Finance path** (left side):
   - Investor → Broker/Dealer → Another Investor
   - FlowArrow with label "Securities"
   - Note: "No balance sheet — just connecting"
   - Characteristics: "Price discovery, liquidity, transparency"

3. **Indirect Finance path** (right side):
   - Saver → Institution (with balance sheet icon) → Borrower
   - FlowArrow: "Deposits" going in, "Loans" going out
   - Balance sheet visualization in the middle
   - Characteristics: "Risk transformation, maturity transformation"

4. **Three problems solved** (when indirect selected):
   - Maturity Mismatch: "Short deposits → Long loans"
   - Price Risk: "Deposits are stable; markets fluctuate"
   - Information Asymmetry: "Banks specialize in evaluating borrowers"
   - Show these as animated cards that appear below

5. **Interactive comparison**:
   - Hover over elements to highlight the comparison
   - When clicking "Broker/Dealer": show "Takes no ownership risk"
   - When clicking "Bank": show "Holds assets on balance sheet"

Style: Two-column glass morphism layout, animated transitions between views.
  </action>
  <verify>Component renders, view toggles work, paths show correct flows</verify>
  <done>Interactive Direct vs Indirect Finance comparison with problem explanations</done>
</task>

<task type="auto">
  <name>Task 2: Create BankBalanceSheet interactive visualization</name>
  <files>src/components/visualizations/diagrams/BankBalanceSheet.tsx</files>
  <action>
Create an interactive bank balance sheet visualization:

```typescript
'use client';

import { useState } from 'react';
import { motion } from '@/lib/motion';
import { AnimatedValue, Slider } from '@/components/visualizations';
import { cn } from '@/lib/utils';

interface BankBalanceSheetProps {
  className?: string;
}

export function BankBalanceSheet({ className }: BankBalanceSheetProps) {
  // Liabilities (sources of funds)
  const [deposits, setDeposits] = useState(800);  // $800B
  const [borrowings, setBorrowings] = useState(100);  // $100B
  const [equity, setEquity] = useState(100);  // $100B

  // Assets (uses of funds)
  const [reserves, setReserves] = useState(100);  // $100B
  const [loans, setLoans] = useState(700);  // $700B
  const [securities, setSecurities] = useState(200);  // $200B
  // ...
}
```

Layout (T-account style):
```
┌─────────────────────────────────────────────────────────┐
│                    BANK BALANCE SHEET                   │
├────────────────────────────┬────────────────────────────┤
│         ASSETS             │       LIABILITIES          │
│     (Uses of Funds)        │    (Sources of Funds)      │
├────────────────────────────┼────────────────────────────┤
│                            │                            │
│  Reserves        $100B     │  Deposits         $800B    │
│  [=====        ]           │  [================     ]   │
│                            │                            │
│  Loans           $700B     │  Borrowings       $100B    │
│  [=============    ]       │  [====            ]        │
│                            │                            │
│  Securities      $200B     │  Equity           $100B    │
│  [========       ]         │  [====            ]        │
│                            │                            │
├────────────────────────────┼────────────────────────────┤
│  TOTAL:          $1000B    │  TOTAL:           $1000B   │
│                            │      (Must Balance!)       │
└────────────────────────────┴────────────────────────────┘
```

Features:
1. **T-account layout**:
   - Left side: Assets (Reserves, Loans, Securities)
   - Right side: Liabilities (Deposits, Borrowings, Equity)
   - Visual bars showing proportion of each

2. **Interactive sliders**:
   - Adjust deposits → automatically adjusts available funds
   - Adjust loans → shows how bank allocates assets
   - Balance constraint: Assets must equal Liabilities
   - If out of balance, show warning indicator

3. **Key ratio display**:
   - Reserve Ratio = Reserves / Deposits (show as percentage)
   - Loan-to-Deposit Ratio = Loans / Deposits
   - Leverage = Total Assets / Equity

4. **Educational insights panel**:
   - "Deposits are liabilities — the bank owes you this money"
   - "Loans are assets — borrowers owe the bank"
   - "Banks profit from the spread: loan rates > deposit rates"

5. **Scenario buttons**:
   - "Normal Bank" - typical proportions
   - "Bank Run" - show what happens when deposits flee
   - "Credit Boom" - high loans, low reserves
   - Each scenario animates the values changing

6. **Maturity mismatch visualization**:
   - Small timeline showing: "Deposits can leave anytime"
   - "Loans locked in for years"
   - Visual representation of the fundamental bank vulnerability

Style: T-account with glass morphism, animated value changes, balance indicator.
  </action>
  <verify>Balance sheet renders, values update interactively, totals always balance</verify>
  <done>Interactive Bank Balance Sheet with scenarios and ratio calculations</done>
</task>

<task type="auto">
  <name>Task 3: Update barrel exports</name>
  <files>src/components/visualizations/diagrams/index.ts</files>
  <action>
Update the diagrams barrel export:

```typescript
// src/components/visualizations/diagrams/index.ts
export { FinancialSystemFlow } from './FinancialSystemFlow';
export { MoneyFunctionsTriangle } from './MoneyFunctionsTriangle';
export { MoneyEvolutionTimeline } from './MoneyEvolutionTimeline';
export { PaymentMethodsFlow } from './PaymentMethodsFlow';
export { DirectIndirectFinance } from './DirectIndirectFinance';
export { BankBalanceSheet } from './BankBalanceSheet';
```
  </action>
  <verify>All exports work correctly</verify>
  <done>All diagram components exported</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run dev` starts without errors
- [ ] `npm run build` succeeds
- [ ] DirectIndirectFinance shows both paths clearly
- [ ] View toggle switches between direct/indirect/both views
- [ ] Three problems (maturity, price, information) explained
- [ ] BankBalanceSheet displays T-account format
- [ ] Sliders update values with balance constraint
- [ ] Scenario buttons animate value changes
- [ ] All components exported correctly
</verification>

<success_criteria>
- All tasks completed
- Direct vs Indirect distinction is crystal clear
- Balance sheet demonstrates banks hold assets (unlike brokers)
- Scenarios show bank vulnerability (runs, credit booms)
- Animations help understanding of dynamic concepts
</success_criteria>

<output>
After completion, create `.planning/phases/04-module-1-content/04-06-SUMMARY.md`
</output>
