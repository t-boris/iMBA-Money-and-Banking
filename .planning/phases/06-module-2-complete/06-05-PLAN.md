---
phase: 06-module-2-complete
plan: 05
type: execute
wave: 3
depends_on: ["06-02", "06-03"]
files_modified: [src/components/visualizations/diagrams/OffBalanceSheetIceberg.tsx, src/components/visualizations/diagrams/IncomeStatementWaterfall.tsx, src/components/visualizations/diagrams/index.ts]
autonomous: true
---

<objective>
Create visualizations for off-balance sheet activities and income statement (Lessons 2-12 and 2-13).

Purpose: Visualize hidden bank risks (OBS activities) and how banks generate profit (income statement components).
Output: Two interactive visualization components with animations.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/STATE.md
@src/components/visualizations/diagrams/RevenueMixComparison.tsx
@src/components/visualizations/AnimatedValue.tsx
@src/lib/motion.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create OffBalanceSheetIceberg visualization</name>
  <files>src/components/visualizations/diagrams/OffBalanceSheetIceberg.tsx</files>
  <action>
Create iceberg visualization showing visible (on-balance sheet) vs hidden (off-balance sheet) risks:

Above waterline (On-Balance Sheet - visible):
- Total Assets: $3.4T (for JPMorgan scale)
- Loans, securities, cash - what we see in financial statements

Below waterline (Off-Balance Sheet - hidden):
- Loan Commitments (Contingent Assets)
  * Credit card undrawn limits (~$500B+)
  * Credit lines to businesses
  * Mortgage commitments
  * "Must fund if customer requests"

- Guarantees (Contingent Liabilities)
  * Letters of credit
  * Performance guarantees
  * "Pay if third party defaults"

- Derivatives (Both sides)
  * Interest rate swaps: $150T+ notional
  * Credit default swaps
  * FX contracts
  * Note: Notional ≠ Market Value (explain with insurance analogy)
  * Netting reduces actual exposure

Interactive features:
- Iceberg visual with waterline animation
- Click categories to see details
- Show the scale difference:
  * On-balance: $3.4T
  * Loan commitments: $1.5T
  * Derivatives notional: $50T+ (but net exposure much smaller)
- Explain why OBS matters:
  * Credit card: undrawn = no asset, but you MUST fund
  * Derivatives: notional is face value, not actual risk
- Highlight concentration risk: 7 banks hold most derivatives

Color scheme:
- Above water (visible): primary blue
- Below water (hidden): darker shades, slightly ominous
- Derivatives: amber (complex/risky)
- Loan commitments: emerald (clearer obligation)

Animation: Gentle bobbing motion for iceberg. Fade-in reveals for details.
  </action>
  <verify>npx tsc --noEmit passes</verify>
  <done>OffBalanceSheetIceberg shows visible vs hidden bank activities</done>
</task>

<task type="auto">
  <name>Task 2: Create IncomeStatementWaterfall visualization</name>
  <files>src/components/visualizations/diagrams/IncomeStatementWaterfall.tsx</files>
  <action>
Create waterfall chart showing how bank revenue becomes profit:

Waterfall flow (left to right or top to bottom):

1. Interest Income (starting point - positive)
   - Income from loans
   - Income from securities
   - Color: emerald

2. - Interest Expense (subtract)
   - Paid on deposits
   - Paid on borrowings
   - Color: red/negative

3. = Net Interest Income (NII) (subtotal)
   - Traditional banking profit
   - Key metric: Net Interest Margin (NIM) = NII / Earning Assets
   - Color: primary blue

4. + Non-Interest Income (add)
   - Fee income (investment banking, advisory)
   - Trading revenue
   - Asset management fees
   - Service charges
   - Color: emerald

5. = Total Revenue (subtotal)
   - Color: primary blue (larger)

6. - Non-Interest Expense (subtract)
   - Salaries and bonuses
   - Technology
   - Occupancy
   - Legal, marketing
   - Color: red/negative

7. - Loan Loss Provisions (subtract)
   - Reserve for expected defaults
   - Color: amber (risk-related)

8. = Net Income (final result)
   - Color: emerald (profit) or red (loss)

Interactive features:
- Animated waterfall building block by block
- Click each segment for breakdown
- Toggle: JPMorgan (mixed) vs Community Bank (NII-dominant)
  - Show how fee income is larger share for big banks
  - Community banks more dependent on interest spread
- Show the formula: NII + Non-Interest Income - Expenses - Provisions = Profit
- Highlight the shift: traditional (3-6-3) → modern (fee-based)

Use AnimatedValue for dollar amounts. Staggered animation for waterfall effect.
  </action>
  <verify>npx tsc --noEmit passes</verify>
  <done>IncomeStatementWaterfall shows revenue-to-profit flow</done>
</task>

<task type="auto">
  <name>Task 3: Export new components</name>
  <files>src/components/visualizations/diagrams/index.ts</files>
  <action>
Add exports for new visualization components:
- export { OffBalanceSheetIceberg } from './OffBalanceSheetIceberg';
- export { IncomeStatementWaterfall } from './IncomeStatementWaterfall';

Add alongside existing exports.
  </action>
  <verify>All exports work</verify>
  <done>Both components exported from diagrams/index.ts</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] npx tsc --noEmit passes
- [ ] npm run build succeeds
- [ ] OffBalanceSheetIceberg renders with interactive categories
- [ ] IncomeStatementWaterfall shows complete flow with animations
</verification>

<success_criteria>
- All tasks completed
- Both visualizations clearly communicate complex financial concepts
- Animations enhance understanding
- TypeScript compiles without errors
</success_criteria>

<output>
After completion, create `.planning/phases/06-module-2-complete/06-05-SUMMARY.md`
</output>
