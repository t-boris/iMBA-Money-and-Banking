---
phase: 04-interactive-visualizations
plan: 03
type: execute
wave: 2
depends_on: ["04-01"]
files_modified: [src/components/visualizations/BankingProcessDiagram.tsx, src/components/visualizations/index.ts]
autonomous: true
---

<objective>
Create the Banking Process diagram showing how deposits and loans work.

Purpose: Build an interactive visualization of the deposit-to-loan process. Users can step through how a bank takes deposits, holds reserves, and makes loans ‚Äî understanding the T-account balance sheet in action.
Output: BankingProcessDiagram component showing bank operations interactively.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-interactive-visualizations/04-CONTEXT.md
@.planning/phases/04-interactive-visualizations/04-01-SUMMARY.md

@src/components/visualizations/index.ts
@src/components/visualizations/Slider.tsx
@src/components/visualizations/Entity.tsx
@src/components/visualizations/FlowArrow.tsx
@src/components/visualizations/AnimatedValue.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create BankingProcessDiagram component</name>
  <files>src/components/visualizations/BankingProcessDiagram.tsx</files>
  <action>
Create a step-by-step banking process visualization:

```typescript
'use client';

import { useState } from 'react';
import { motion, AnimatePresence } from '@/lib/motion';
import { Slider, AnimatedValue, Entity, FlowArrow } from './index';
import { Card, CardHeader, CardTitle, CardContent, Button } from '@/components/ui';
import { cn } from '@/lib/utils';

interface BankingProcessDiagramProps {
  className?: string;
}

const STEPS = [
  {
    id: 1,
    title: 'Customer Deposits Cash',
    description: 'A customer brings $1,000 cash to deposit in their checking account.',
    highlight: 'depositor',
  },
  {
    id: 2,
    title: 'Bank Records the Deposit',
    description: 'The bank adds $1,000 to assets (reserves) and $1,000 to liabilities (customer deposit).',
    highlight: 'bank',
  },
  {
    id: 3,
    title: 'Bank Holds Required Reserves',
    description: 'With a 10% reserve requirement, the bank must hold $100 in reserves.',
    highlight: 'reserves',
  },
  {
    id: 4,
    title: 'Bank Makes a Loan',
    description: 'The bank can lend out $900 (excess reserves) to a borrower.',
    highlight: 'borrower',
  },
  {
    id: 5,
    title: 'New Money Created',
    description: 'The borrower now has $900. The original depositor still has $1,000. Total deposits: $1,900!',
    highlight: 'all',
  },
];

export function BankingProcessDiagram({ className }: BankingProcessDiagramProps) {
  const [currentStep, setCurrentStep] = useState(1);
  const [depositAmount, setDepositAmount] = useState(1000);
  const reserveRatio = 0.1;

  const reserves = depositAmount * reserveRatio;
  const loanAmount = depositAmount - reserves;
  const totalDeposits = currentStep >= 5 ? depositAmount + loanAmount : depositAmount;

  const step = STEPS[currentStep - 1];

  const isHighlighted = (entity: string) => {
    if (step.highlight === 'all') return true;
    return step.highlight === entity;
  };

  return (
    <Card variant="glass" className={cn('overflow-hidden', className)}>
      <CardHeader>
        <CardTitle className="flex items-center gap-2">
          <span>üè¶</span>
          How Banking Works: Deposits & Loans
        </CardTitle>
      </CardHeader>
      <CardContent className="space-y-6">
        {/* Deposit Amount Control */}
        <Slider
          label="Deposit Amount"
          value={depositAmount}
          onChange={setDepositAmount}
          min={100}
          max={5000}
          step={100}
          formatValue={(v) => `$${v.toLocaleString()}`}
        />

        {/* Step Progress */}
        <div className="flex gap-2">
          {STEPS.map((s) => (
            <button
              key={s.id}
              onClick={() => setCurrentStep(s.id)}
              className={cn(
                'flex-1 h-2 rounded-full transition-colors',
                currentStep >= s.id ? 'bg-primary-500' : 'bg-surface-2'
              )}
            />
          ))}
        </div>

        {/* Step Info */}
        <AnimatePresence mode="wait">
          <motion.div
            key={currentStep}
            initial={{ opacity: 0, y: 10 }}
            animate={{ opacity: 1, y: 0 }}
            exit={{ opacity: 0, y: -10 }}
            className="bg-primary-500/10 border border-primary-500/20 rounded-lg p-4"
          >
            <div className="flex items-center gap-2 mb-2">
              <span className="w-6 h-6 rounded-full bg-primary-500 text-white text-sm font-bold flex items-center justify-center">
                {currentStep}
              </span>
              <h4 className="font-semibold text-text-primary">{step.title}</h4>
            </div>
            <p className="text-sm text-text-secondary">{step.description}</p>
          </motion.div>
        </AnimatePresence>

        {/* Visual Diagram */}
        <div className="relative py-8">
          <div className="flex items-center justify-between gap-4">
            {/* Depositor */}
            <motion.div
              animate={{
                scale: isHighlighted('depositor') ? 1.05 : 1,
                opacity: currentStep >= 1 ? 1 : 0.3,
              }}
            >
              <Entity
                icon="üë§"
                label="Depositor"
                value={`$${depositAmount.toLocaleString()}`}
                subtext="Checking Account"
                highlighted={isHighlighted('depositor')}
              />
            </motion.div>

            {/* Arrow to Bank */}
            <motion.div
              animate={{ opacity: currentStep >= 1 ? 1 : 0.3 }}
            >
              <FlowArrow
                direction="right"
                animated={currentStep === 1}
                label="Deposit"
                value={`$${depositAmount.toLocaleString()}`}
              />
            </motion.div>

            {/* Bank */}
            <motion.div
              animate={{
                scale: isHighlighted('bank') ? 1.05 : 1,
                opacity: currentStep >= 2 ? 1 : 0.3,
              }}
              className="space-y-2"
            >
              <Entity
                icon="üè¶"
                label="Bank"
                highlighted={isHighlighted('bank')}
              />
              {currentStep >= 3 && (
                <motion.div
                  initial={{ opacity: 0, y: -10 }}
                  animate={{ opacity: 1, y: 0 }}
                  className="flex gap-2 text-xs"
                >
                  <div className={cn(
                    'px-2 py-1 rounded',
                    isHighlighted('reserves') ? 'bg-primary-500 text-white' : 'bg-surface-2 text-text-muted'
                  )}>
                    Reserves: ${reserves.toLocaleString()}
                  </div>
                </motion.div>
              )}
            </motion.div>

            {/* Arrow to Borrower */}
            <motion.div
              animate={{ opacity: currentStep >= 4 ? 1 : 0.3 }}
            >
              <FlowArrow
                direction="right"
                animated={currentStep === 4}
                label="Loan"
                value={`$${loanAmount.toLocaleString()}`}
              />
            </motion.div>

            {/* Borrower */}
            <motion.div
              animate={{
                scale: isHighlighted('borrower') ? 1.05 : 1,
                opacity: currentStep >= 4 ? 1 : 0.3,
              }}
            >
              <Entity
                icon="üè†"
                label="Borrower"
                value={currentStep >= 4 ? `$${loanAmount.toLocaleString()}` : '-'}
                subtext="Loan Received"
                highlighted={isHighlighted('borrower')}
              />
            </motion.div>
          </div>
        </div>

        {/* Summary Stats */}
        {currentStep >= 5 && (
          <motion.div
            initial={{ opacity: 0, y: 20 }}
            animate={{ opacity: 1, y: 0 }}
            className="grid grid-cols-3 gap-4 text-center py-4 bg-surface-0 rounded-xl"
          >
            <div>
              <div className="text-xs text-text-muted uppercase tracking-wider mb-1">
                Original Cash
              </div>
              <AnimatedValue
                value={depositAmount}
                prefix="$"
                decimals={0}
                size="md"
              />
            </div>
            <div>
              <div className="text-xs text-text-muted uppercase tracking-wider mb-1">
                Total Deposits
              </div>
              <AnimatedValue
                value={totalDeposits}
                prefix="$"
                decimals={0}
                size="md"
                className="text-primary-500"
              />
            </div>
            <div>
              <div className="text-xs text-text-muted uppercase tracking-wider mb-1">
                Money Created
              </div>
              <AnimatedValue
                value={loanAmount}
                prefix="+$"
                decimals={0}
                size="md"
                className="text-green-500"
              />
            </div>
          </motion.div>
        )}

        {/* Navigation Buttons */}
        <div className="flex gap-3">
          <Button
            variant="secondary"
            onClick={() => setCurrentStep((s) => Math.max(1, s - 1))}
            disabled={currentStep === 1}
            className="flex-1"
          >
            ‚Üê Previous
          </Button>
          <Button
            variant="primary"
            onClick={() => setCurrentStep((s) => Math.min(STEPS.length, s + 1))}
            disabled={currentStep === STEPS.length}
            className="flex-1"
          >
            Next ‚Üí
          </Button>
        </div>
      </CardContent>
    </Card>
  );
}
```

Key features:
- Step-by-step walkthrough with navigation
- Deposit amount slider for exploration
- Entities highlight based on current step
- Animated transitions between steps
- Summary showing money creation
  </action>
  <verify>All 5 steps work, entities highlight correctly, amounts update</verify>
  <done>BankingProcessDiagram with step-through visualization of deposit-to-loan process.</done>
</task>

<task type="auto">
  <name>Task 2: Export BankingProcessDiagram</name>
  <files>src/components/visualizations/index.ts</files>
  <action>
Add BankingProcessDiagram to barrel export:

```typescript
export { Slider } from './Slider';
export { AnimatedValue } from './AnimatedValue';
export { FlowArrow } from './FlowArrow';
export { Entity } from './Entity';
export { MoneyFlowDiagram } from './MoneyFlowDiagram';
export { BankingProcessDiagram } from './BankingProcessDiagram';
```
  </action>
  <verify>Export works, component importable</verify>
  <done>BankingProcessDiagram exported from visualizations barrel.</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run dev` starts without errors
- [ ] `npm run build` succeeds
- [ ] BankingProcessDiagram renders correctly
- [ ] Step navigation works (next/previous)
- [ ] Progress bar shows current step
- [ ] Entities highlight based on step
- [ ] Deposit slider updates amounts throughout
- [ ] Final step shows money creation summary
</verification>

<success_criteria>
- All tasks completed
- Banking process is visually clear step-by-step
- Cause-effect obvious (deposit leads to reserves + loans)
- Interactive exploration via slider and step navigation
</success_criteria>

<output>
After completion, create `.planning/phases/04-interactive-visualizations/04-03-SUMMARY.md`
</output>
