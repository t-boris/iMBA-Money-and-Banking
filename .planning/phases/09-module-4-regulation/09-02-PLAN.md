---
phase: 09-module-4-regulation
plan: 02
type: execute
wave: 2
depends_on: ["09-01"]
files_modified:
  - src/components/visualizations/diagrams/ExternalityDiagram.tsx
  - src/components/visualizations/diagrams/SafetyNetFlow.tsx
  - src/components/visualizations/diagrams/ContagionNetwork.tsx
  - src/components/visualizations/diagrams/index.ts
autonomous: true
---

<objective>
Build three visualization components for Lessons 4-1.1 and 4-1.2: Externality Diagram, Safety Net Flow, and Contagion Network.

Purpose: Create interactive visualizations for the regulation goals and safety net lessons.
Output: Three new diagram components registered in the visualizations barrel export.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

@src/components/visualizations/diagrams/RiskTypesPentagon.tsx
@src/components/visualizations/diagrams/LiquidityCrisisFlow.tsx
@src/components/visualizations/diagrams/index.ts
@src/types/index.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create ExternalityDiagram component</name>
  <files>src/components/visualizations/diagrams/ExternalityDiagram.tsx</files>
  <action>
  Create an interactive visualization showing the externality logic of bank regulation.

  Design: Two-panel comparison using motion animations.

  **Panel 1 — Private Cost vs Social Cost:**
  - Visual bar chart or stacked comparison showing:
    - Bank's private cost of risk-taking (lower)
    - Society's full cost including spillovers (higher)
    - The gap = negative externality
  - Animate bars growing on mount
  - Color: private cost in blue/primary, social cost in rose/red

  **Panel 2 — Bank Failure Spillover Chain:**
  - Animated flow showing bank failure consequences:
    - Bank fails → Lost credit access → Lost savings → Taxpayer cost → Contagion to other banks
  - Each step appears with stagger animation
  - Click any step to expand with detail text from course notes

  **Panel 3 — Micro vs Macro Prudential toggle:**
  - Toggle button switching between two views
  - Microprudential: Shows single bank with protective regulations (capital, limits)
  - Macroprudential: Shows network of banks with system-wide regulations (surcharges, systemic oversight)
  - Use SVG circles for banks, lines for connections
  - Macro view highlights how bigger banks get stricter rules

  Follow existing component patterns: 'use client', motion/react imports, glass morphism card styling, Tailwind CSS, responsive layout.
  </action>
  <verify>npm run build succeeds without errors</verify>
  <done>ExternalityDiagram renders private vs social cost comparison, failure spillover chain, and micro/macro prudential toggle.</done>
</task>

<task type="auto">
  <name>Task 2: Create SafetyNetFlow and ContagionNetwork components</name>
  <files>src/components/visualizations/diagrams/SafetyNetFlow.tsx, src/components/visualizations/diagrams/ContagionNetwork.tsx, src/components/visualizations/diagrams/index.ts</files>
  <action>
  **SafetyNetFlow.tsx:**
  Interactive visualization showing the two pillars of the government safety net.

  Design: Split-panel "Before vs During" crisis comparison:

  Left panel — "Ex-Ante Protection" (FDIC Deposit Insurance):
  - Show depositor → bank relationship
  - FDIC shield icon protecting deposits
  - Animated: depositor thinks "My money is safe" → no run
  - Show $250,000 coverage limit
  - Key text: "Removes incentive to run BEFORE panic starts"

  Right panel — "Ex-Post Stabilization" (Lender of Last Resort):
  - Show bank facing withdrawals
  - Fed provides emergency cash loan
  - Bank services depositors
  - Later repays Fed
  - Key text: "Stops run DURING panic"

  Bottom section — Moral Hazard warning:
  - Toggle to show the downside
  - "Insurance → Riskier behavior" logic
  - Animated: protected bank taking bigger risks
  - Heads → bank keeps profits / Tails → government absorbs losses

  **ContagionNetwork.tsx:**
  Interactive network diagram showing how bank failures spread.

  Design: SVG network with animated contagion:

  - 8-10 bank nodes (circles) connected by lines (interbank links)
  - One central "failing bank" node in red
  - Two contagion channels toggleable:
    1. Information Contagion: "Can't tell good from bad" → all banks turn yellow
    2. Interconnection Contagion: ripple effect through connected lines
  - Click "Trigger Failure" button to animate the contagion spreading step by step
  - Show consequences at bottom: credit stops, markets freeze, economy contracts
  - Use spring animations for node color changes

  Follow existing patterns: glass morphism cards, spring animations (stiffness: 100, damping: 20), Tailwind colors, responsive.

  **Update diagrams/index.ts:**
  Add exports for ExternalityDiagram, SafetyNetFlow, ContagionNetwork.
  </action>
  <verify>npm run build succeeds without errors</verify>
  <done>SafetyNetFlow renders FDIC/LOLR comparison with moral hazard toggle. ContagionNetwork renders interactive bank failure spread animation. Both exported from diagrams/index.ts.</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] npm run build succeeds
- [ ] ExternalityDiagram renders three panels with animations
- [ ] SafetyNetFlow renders ex-ante/ex-post comparison
- [ ] ContagionNetwork renders interactive failure spread
- [ ] All components exported from diagrams/index.ts
</verification>

<success_criteria>
- All tasks completed
- Three visualization components working
- Consistent with existing visualization style
- No TypeScript errors
</success_criteria>

<output>
After completion, create `.planning/phases/09-module-4-regulation/09-02-SUMMARY.md`
</output>
