---
phase: 07-module-3-content
plan: 03
type: execute
wave: 2
depends_on: ["07-01"]
files_modified: [src/components/visualizations/diagrams/ROECalculator.tsx, src/components/visualizations/diagrams/LeverageDecomposition.tsx]
autonomous: true
---

<objective>
Create ROA/ROE/Leverage Calculator and Performance Decomposition visualization.

Purpose: Interactive tools to understand bank profitability metrics and the leverage multiplier effect.
Output: Two interactive calculator/visualization components for Lesson 3-1.2.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/07-module-3-content/07-01-SUMMARY.md

# Pattern reference:
@src/components/visualizations/InterestSpreadCalculator.tsx
@src/components/visualizations/calculators/M1M2Calculator.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create ROE Calculator with real bank examples</name>
  <files>src/components/visualizations/diagrams/ROECalculator.tsx</files>
  <action>
Create an interactive ROA/ROE calculator that demonstrates the leverage effect:

**Input Controls:**
- Net Income slider ($1B - $50B range)
- Total Assets slider ($100B - $4T range)
- Total Equity slider ($10B - $300B range)
- OR: Bank preset selector with real examples:
  - JPMorgan Chase (Net Income: ~$48B, Assets: ~$3.7T, Equity: ~$300B)
  - Bank of America (Net Income: ~$26B, Assets: ~$3.2T, Equity: ~$270B)
  - Community Bank (Net Income: ~$50M, Assets: ~$2B, Equity: ~$200M)

**Calculated Outputs (auto-update):**
- ROA = Net Income / Assets (display as %)
- ROE = Net Income / Equity (display as %)
- Leverage = Assets / Equity (display as X multiplier)
- Verification: ROE = ROA × Leverage (show formula with values)

**Visual Elements:**
- Three animated value displays (ROA, ROE, Leverage)
- Visual bar showing ROA "amplified" by Leverage to get ROE
- Color coding:
  - ROA: blue (typically 0.5-1.5%)
  - Leverage: orange (typically 8-15x)
  - ROE: green (result, typically 8-15%)

**Key Insight Display:**
- "Small ROA × Large Leverage = Significant ROE"
- Warning when leverage is very high: "High leverage amplifies both gains AND losses"

**Animation:**
- Smooth transitions as sliders move
- Number counting animation for values
- Spring physics for value displays (stiffness: 100, damping: 20)

Use existing AnimatedValue component pattern if available, otherwise create inline.
Format large numbers with commas and appropriate units ($B, $T).
  </action>
  <verify>npm run build succeeds, calculator produces correct ROE = ROA × Leverage</verify>
  <done>Interactive ROE calculator with bank presets and leverage visualization</done>
</task>

<task type="auto">
  <name>Task 2: Create Leverage Decomposition visualization</name>
  <files>src/components/visualizations/diagrams/LeverageDecomposition.tsx</files>
  <action>
Create a visual decomposition showing how leverage amplifies returns:

**Main Visual:**
- Horizontal bar chart showing the relationship:
  ```
  ROA (small bar) ──[× Leverage]──> ROE (larger bar)
  ```
- Animated multiplier effect visualization

**Scenario Toggle:**
- "Good Times" vs "Bad Times" toggle
- Good Times:
  - ROA: +1.0%
  - Leverage: 12x
  - ROE: +12.0% (green, positive)

- Bad Times:
  - ROA: -1.0%
  - Leverage: 12x
  - ROE: -12.0% (red, negative)

**Key Message:**
- Same leverage, opposite outcomes
- "Leverage is a double-edged sword"

**Historical Context Panel:**
- Industry average ROA trend (1-1.2% historically, dips during crises)
- Industry average ROE trend (10-15%, crashes during crises)
- Leverage ratio trend (8-12x typically)
- Highlight 2008 crisis: negative ROA → massive negative ROE

**Visual Style:**
- Use existing color tokens
- Animated transitions between Good/Bad times
- Clear labeling of the × multiplier
- Pulsing effect on the amplification zone

Follow component patterns from existing visualizations.
Include formula display: ROE = ROA × (Assets/Equity)
  </action>
  <verify>npm run build succeeds, toggle correctly flips ROE from positive to negative</verify>
  <done>Leverage decomposition with good/bad times toggle and historical context</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] npm run build succeeds
- [ ] ROECalculator correctly calculates ROE = ROA × Leverage
- [ ] Bank presets load with accurate real-world values
- [ ] LeverageDecomposition toggles between scenarios smoothly
- [ ] Both components handle edge cases (division by zero, etc.)
- [ ] Animations are smooth and values animate correctly
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- Calculator produces accurate results
- Visual clearly demonstrates leverage amplification effect
</success_criteria>

<output>
After completion, create `.planning/phases/07-module-3-content/07-03-SUMMARY.md`
</output>
