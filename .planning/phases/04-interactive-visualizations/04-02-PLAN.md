---
phase: 04-interactive-visualizations
plan: 02
type: execute
wave: 2
depends_on: ["04-01"]
files_modified: [src/components/visualizations/MoneyFlowDiagram.tsx, src/components/visualizations/index.ts]
autonomous: true
---

<objective>
Create the Money Flow diagram showing how money moves through the financial system.

Purpose: Build an interactive visualization where users see money flow between entities (Fed, banks, depositors, borrowers). Users can adjust deposit amounts and see how the money multiplier works in real-time.
Output: MoneyFlowDiagram component demonstrating the money creation process.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-interactive-visualizations/04-CONTEXT.md
@.planning/phases/04-interactive-visualizations/04-01-SUMMARY.md

@src/components/visualizations/index.ts
@src/components/visualizations/Slider.tsx
@src/components/visualizations/Entity.tsx
@src/components/visualizations/FlowArrow.tsx
@src/components/visualizations/AnimatedValue.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create MoneyFlowDiagram component</name>
  <files>src/components/visualizations/MoneyFlowDiagram.tsx</files>
  <action>
Create an interactive diagram showing money multiplier and bank reserves:

```typescript
'use client';

import { useState, useMemo } from 'react';
import { motion } from '@/lib/motion';
import { Slider, AnimatedValue, Entity, FlowArrow } from './index';
import { Card, CardHeader, CardTitle, CardContent } from '@/components/ui';
import { cn } from '@/lib/utils';

interface MoneyFlowDiagramProps {
  className?: string;
}

export function MoneyFlowDiagram({ className }: MoneyFlowDiagramProps) {
  const [initialDeposit, setInitialDeposit] = useState(1000);
  const [reserveRatio, setReserveRatio] = useState(10);

  // Calculate money multiplier effect
  const calculations = useMemo(() => {
    const ratio = reserveRatio / 100;
    const multiplier = 1 / ratio;
    const totalMoneyCreated = initialDeposit * multiplier;
    const totalReserves = initialDeposit;
    const totalLoans = totalMoneyCreated - totalReserves;

    // Show first 4 rounds of lending
    const rounds = [];
    let currentDeposit = initialDeposit;
    for (let i = 0; i < 4; i++) {
      const reserves = currentDeposit * ratio;
      const loans = currentDeposit - reserves;
      rounds.push({
        round: i + 1,
        deposit: currentDeposit,
        reserves,
        loans,
      });
      currentDeposit = loans;
    }

    return { multiplier, totalMoneyCreated, totalReserves, totalLoans, rounds };
  }, [initialDeposit, reserveRatio]);

  return (
    <Card variant="glass" className={cn('overflow-hidden', className)}>
      <CardHeader>
        <CardTitle className="flex items-center gap-2">
          <span>ðŸ’°</span>
          Money Multiplier & Bank Reserves
        </CardTitle>
      </CardHeader>
      <CardContent className="space-y-6">
        {/* Controls */}
        <div className="grid md:grid-cols-2 gap-6">
          <Slider
            label="Initial Deposit"
            value={initialDeposit}
            onChange={setInitialDeposit}
            min={100}
            max={10000}
            step={100}
            formatValue={(v) => `$${v.toLocaleString()}`}
          />
          <Slider
            label="Reserve Ratio"
            value={reserveRatio}
            onChange={setReserveRatio}
            min={1}
            max={25}
            step={1}
            unit="%"
          />
        </div>

        {/* Key Metrics */}
        <div className="grid grid-cols-3 gap-4 text-center py-4 bg-surface-0 rounded-xl">
          <div>
            <div className="text-xs text-text-muted uppercase tracking-wider mb-1">
              Money Multiplier
            </div>
            <AnimatedValue
              value={calculations.multiplier}
              suffix="x"
              decimals={1}
              size="lg"
              className="text-primary-500"
            />
          </div>
          <div>
            <div className="text-xs text-text-muted uppercase tracking-wider mb-1">
              Total Money Created
            </div>
            <AnimatedValue
              value={calculations.totalMoneyCreated}
              prefix="$"
              decimals={0}
              size="lg"
              className="text-text-primary"
            />
          </div>
          <div>
            <div className="text-xs text-text-muted uppercase tracking-wider mb-1">
              Total Loans
            </div>
            <AnimatedValue
              value={calculations.totalLoans}
              prefix="$"
              decimals={0}
              size="lg"
              className="text-text-primary"
            />
          </div>
        </div>

        {/* Flow Visualization */}
        <div className="space-y-4">
          <h4 className="text-sm font-semibold text-text-primary">
            How It Works: First 4 Rounds
          </h4>

          {calculations.rounds.map((round, index) => (
            <motion.div
              key={round.round}
              initial={{ opacity: 0, x: -20 }}
              animate={{ opacity: 1, x: 0 }}
              transition={{ delay: index * 0.1 }}
              className="flex items-center gap-3 p-3 bg-surface-0 rounded-lg"
            >
              <div className="w-8 h-8 rounded-full bg-primary-500/10 flex items-center justify-center text-primary-500 font-bold text-sm">
                {round.round}
              </div>

              <Entity
                icon="ðŸ¦"
                label="Bank"
                value={`$${round.deposit.toFixed(0)}`}
                subtext="Deposit"
                className="flex-1 py-2"
              />

              <FlowArrow direction="right" animated={index === 0} />

              <div className="flex-1 grid grid-cols-2 gap-2">
                <div className="text-center p-2 bg-surface-1 rounded-lg">
                  <div className="text-xs text-text-muted">Reserves</div>
                  <div className="font-semibold text-text-primary">
                    ${round.reserves.toFixed(0)}
                  </div>
                </div>
                <div className="text-center p-2 bg-primary-500/10 rounded-lg">
                  <div className="text-xs text-text-muted">Loans Out</div>
                  <div className="font-semibold text-primary-500">
                    ${round.loans.toFixed(0)}
                  </div>
                </div>
              </div>
            </motion.div>
          ))}

          <div className="text-center text-sm text-text-muted pt-2">
            ... and so on, until loans approach $0
          </div>
        </div>

        {/* Explanation */}
        <div className="text-sm text-text-secondary bg-surface-0 p-4 rounded-lg">
          <strong>Key Insight:</strong> With a {reserveRatio}% reserve ratio, banks must hold
          ${(initialDeposit * reserveRatio / 100).toFixed(0)} in reserves and can lend out
          ${(initialDeposit * (100 - reserveRatio) / 100).toFixed(0)}. When that loan is deposited
          elsewhere, the process repeats â€” creating a{' '}
          <span className="text-primary-500 font-semibold">
            {calculations.multiplier.toFixed(1)}x
          </span>{' '}
          multiplication of the original deposit.
        </div>
      </CardContent>
    </Card>
  );
}
```

Key features:
- Two sliders: initial deposit and reserve ratio
- Real-time calculation of money multiplier
- Animated value displays for key metrics
- Step-by-step visualization of lending rounds
- Clear cause-effect relationship shown visually
  </action>
  <verify>Diagram renders, sliders update calculations instantly, animations smooth</verify>
  <done>MoneyFlowDiagram with interactive sliders and animated money multiplier visualization.</done>
</task>

<task type="auto">
  <name>Task 2: Export MoneyFlowDiagram and add to module page</name>
  <files>src/components/visualizations/index.ts</files>
  <action>
Add MoneyFlowDiagram to barrel export:

```typescript
export { Slider } from './Slider';
export { AnimatedValue } from './AnimatedValue';
export { FlowArrow } from './FlowArrow';
export { Entity } from './Entity';
export { MoneyFlowDiagram } from './MoneyFlowDiagram';
```

Note: Integration with module pages will happen in plan 04-04 after all visualizations are built.
  </action>
  <verify>Export works, component importable</verify>
  <done>MoneyFlowDiagram exported from visualizations barrel.</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run dev` starts without errors
- [ ] `npm run build` succeeds
- [ ] MoneyFlowDiagram renders correctly
- [ ] Initial deposit slider updates calculations in real-time
- [ ] Reserve ratio slider updates money multiplier
- [ ] AnimatedValue components show smooth transitions
- [ ] Lending rounds animate on load
</verification>

<success_criteria>
- All tasks completed
- Money multiplier concept is visually clear
- Instant feedback on slider changes
- Cause-effect relationship obvious (change reserve ratio â†’ see multiplier change)
</success_criteria>

<output>
After completion, create `.planning/phases/04-interactive-visualizations/04-02-SUMMARY.md`
</output>
