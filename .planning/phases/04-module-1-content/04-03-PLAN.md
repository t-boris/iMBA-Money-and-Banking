---
phase: 04-module-1-content
plan: 03
type: execute
wave: 2
depends_on: ["04-01", "04-02"]
files_modified: [src/components/visualizations/diagrams/FinancialSystemFlow.tsx, src/components/visualizations/diagrams/index.ts]
autonomous: true
---

<objective>
Build the Financial System Flow diagram â€” the foundational visualization showing Savers â†’ Financial System â†’ Borrowers.

Purpose: Create the core animated diagram that shows how money flows from savers through the financial system to borrowers. This is THE central concept of Module 1 and the visual that appears in the course notes.
Output: Interactive, animated Financial System Flow diagram component.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-module-1-content/04-CONTEXT.md

@src/components/visualizations/index.ts
@src/lib/motion.ts
@src/lib/utils.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create FinancialSystemFlow diagram component</name>
  <files>src/components/visualizations/diagrams/FinancialSystemFlow.tsx</files>
  <action>
Create an interactive diagram showing the flow: Savers â†’ Financial System â†’ Borrowers

```typescript
'use client';

import { useState } from 'react';
import { motion } from '@/lib/motion';
import { Entity, FlowArrow, AnimatedValue } from '@/components/visualizations';
import { cn } from '@/lib/utils';

interface FinancialSystemFlowProps {
  className?: string;
}

export function FinancialSystemFlow({ className }: FinancialSystemFlowProps) {
  const [selectedEntity, setSelectedEntity] = useState<string | null>(null);
  // ... implementation
}
```

Layout structure (horizontal flow):
```
[Savers]  â†’  [Financial System]  â†’  [Borrowers]
   â”‚              â”‚                      â”‚
   â”‚         â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”                 â”‚
   â”‚         â”‚         â”‚                 â”‚
   â”‚      Markets  Institutions          â”‚
   â”‚                                     â”‚
   â””â”€â”€â”€â”€â”€â”€â”€ Financial Instruments â”€â”€â”€â”€â”€â”€â”€â”˜
```

Features:
1. **Three main entities** using Entity component:
   - Savers (icon: ğŸ’°, label: "Savers", subtext: "Households with excess income")
   - Financial System (icon: ğŸ›ï¸, label: "Financial System", subtext: "Markets & Institutions")
   - Borrowers (icon: ğŸ , label: "Borrowers", subtext: "Households, Businesses, Government")

2. **Animated flow arrows** using FlowArrow component:
   - Savers â†’ Financial System (animated=true, label: "Funds")
   - Financial System â†’ Borrowers (animated=true, label: "Loans/Investment")

3. **Interactive highlighting**:
   - Click on any entity to highlight it and show details
   - When Savers selected: show "Deposits, Insurance, Investments"
   - When Financial System selected: show "Banks, Markets, Funds"
   - When Borrowers selected: show "Mortgages, Business Loans, Government Bonds"

4. **Money particles animation**:
   - Small dollar signs or circles flowing along the arrows
   - Use motion with repeat: Infinity for continuous flow
   - Green/primary color particles

5. **Responsive layout**:
   - Horizontal on desktop
   - Vertical stack on mobile (use flex-col at sm breakpoint)

Style: Glass morphism cards for entities, smooth animations, primary color accents.
  </action>
  <verify>Component renders, arrows animate, clicking entities shows details</verify>
  <done>Financial System Flow diagram with animated flows and interactive entities</done>
</task>

<task type="auto">
  <name>Task 2: Add detail panels and create barrel export</name>
  <files>src/components/visualizations/diagrams/FinancialSystemFlow.tsx, src/components/visualizations/diagrams/index.ts</files>
  <action>
Enhance FinancialSystemFlow with expandable detail panels:

When an entity is selected, show a detail panel below it:

**Savers detail panel:**
- "Who are savers?"
- List: Households, Pension savers, Insurance policyholders
- "They have more income than they spend today"

**Financial System detail panel:**
- "What does it do?"
- Two columns: Markets (direct) | Institutions (indirect)
- "Channels funds from savers to borrowers"

**Borrowers detail panel:**
- "Who are borrowers?"
- List: Homebuyers (mortgages), Businesses (investment), Government (infrastructure)
- "They need funds today for future projects"

Add motion AnimatePresence for smooth panel enter/exit animations.

Create barrel export:
```typescript
// src/components/visualizations/diagrams/index.ts
export { FinancialSystemFlow } from './FinancialSystemFlow';
```

Also update the main visualizations barrel:
```typescript
// src/components/visualizations/index.ts
// ... existing exports
export * from './diagrams';
```
  </action>
  <verify>Detail panels animate in/out, barrel exports work</verify>
  <done>Interactive detail panels with animations, exports configured</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run dev` starts without errors
- [ ] `npm run build` succeeds
- [ ] Financial System Flow renders with three entities
- [ ] Arrows show animated flowing particles
- [ ] Clicking entities highlights them and shows detail panel
- [ ] Detail panels animate smoothly in/out
- [ ] Responsive: horizontal on desktop, vertical on mobile
- [ ] Component exported from visualizations barrel
</verification>

<success_criteria>
- All tasks completed
- Diagram visually represents the Savers â†’ Financial System â†’ Borrowers flow
- Animations are smooth and playful (money flowing)
- Interactive elements provide educational value
- Follows glass morphism design
</success_criteria>

<output>
After completion, create `.planning/phases/04-module-1-content/04-03-SUMMARY.md`
</output>
