---
phase: 04-interactive-visualizations
plan: 01
type: execute
wave: 1
depends_on: []
files_modified: [src/components/visualizations/Slider.tsx, src/components/visualizations/AnimatedValue.tsx, src/components/visualizations/FlowArrow.tsx, src/components/visualizations/Entity.tsx, src/components/visualizations/index.ts, src/types/index.ts]
autonomous: true
---

<objective>
Build foundational visualization components for interactive financial diagrams.

Purpose: Create reusable primitives that all visualizations will use â€” interactive sliders, animated value displays, flow arrows, and entity boxes. These form the building blocks for money flows, banking processes, and interest rate visualizations.
Output: Base visualization component library ready for composition into specific diagrams.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-interactive-visualizations/04-CONTEXT.md

@src/lib/motion.ts
@src/lib/utils.ts
@src/components/ui/index.ts
@src/types/index.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create interactive Slider component</name>
  <files>src/components/visualizations/Slider.tsx</files>
  <action>
Create a styled slider component with real-time value display:

```typescript
'use client';

import { useState, useCallback } from 'react';
import { motion } from '@/lib/motion';
import { cn } from '@/lib/utils';

interface SliderProps {
  label: string;
  value: number;
  onChange: (value: number) => void;
  min: number;
  max: number;
  step?: number;
  unit?: string;
  formatValue?: (value: number) => string;
  className?: string;
}

export function Slider({
  label,
  value,
  onChange,
  min,
  max,
  step = 1,
  unit = '',
  formatValue,
  className,
}: SliderProps) {
  const displayValue = formatValue ? formatValue(value) : `${value}${unit}`;
  const percentage = ((value - min) / (max - min)) * 100;

  return (
    <div className={cn('space-y-2', className)}>
      <div className="flex justify-between items-center">
        <label className="text-sm font-medium text-text-primary">{label}</label>
        <motion.span
          key={value}
          initial={{ scale: 1.1, color: 'var(--color-primary-500)' }}
          animate={{ scale: 1, color: 'var(--color-text-primary)' }}
          className="text-sm font-mono font-semibold"
        >
          {displayValue}
        </motion.span>
      </div>
      <div className="relative">
        <input
          type="range"
          min={min}
          max={max}
          step={step}
          value={value}
          onChange={(e) => onChange(Number(e.target.value))}
          className={cn(
            'w-full h-2 rounded-full appearance-none cursor-pointer',
            'bg-surface-2',
            '[&::-webkit-slider-thumb]:appearance-none',
            '[&::-webkit-slider-thumb]:w-5 [&::-webkit-slider-thumb]:h-5',
            '[&::-webkit-slider-thumb]:rounded-full',
            '[&::-webkit-slider-thumb]:bg-primary-500',
            '[&::-webkit-slider-thumb]:shadow-md',
            '[&::-webkit-slider-thumb]:cursor-pointer',
            '[&::-webkit-slider-thumb]:transition-transform',
            '[&::-webkit-slider-thumb]:hover:scale-110',
            '[&::-moz-range-thumb]:w-5 [&::-moz-range-thumb]:h-5',
            '[&::-moz-range-thumb]:rounded-full',
            '[&::-moz-range-thumb]:bg-primary-500',
            '[&::-moz-range-thumb]:border-0',
            '[&::-moz-range-thumb]:cursor-pointer'
          )}
          style={{
            background: `linear-gradient(to right, var(--color-primary-500) 0%, var(--color-primary-500) ${percentage}%, var(--color-surface-2) ${percentage}%, var(--color-surface-2) 100%)`,
          }}
        />
      </div>
    </div>
  );
}
```

Key features:
- Animated value display that pulses on change
- Filled track showing progress
- Styled thumb with hover effect
- Customizable formatting and units
  </action>
  <verify>Component renders, dragging updates value with animation</verify>
  <done>Slider with real-time feedback and value animation.</done>
</task>

<task type="auto">
  <name>Task 2: Create AnimatedValue display component</name>
  <files>src/components/visualizations/AnimatedValue.tsx</files>
  <action>
Create a component that animates between numeric values smoothly:

```typescript
'use client';

import { useEffect, useState } from 'react';
import { motion, useSpring, useTransform } from 'motion/react';
import { cn } from '@/lib/utils';

interface AnimatedValueProps {
  value: number;
  prefix?: string;
  suffix?: string;
  decimals?: number;
  className?: string;
  size?: 'sm' | 'md' | 'lg' | 'xl';
}

export function AnimatedValue({
  value,
  prefix = '',
  suffix = '',
  decimals = 0,
  className,
  size = 'md',
}: AnimatedValueProps) {
  const spring = useSpring(value, { stiffness: 100, damping: 20 });
  const display = useTransform(spring, (v) => v.toFixed(decimals));

  useEffect(() => {
    spring.set(value);
  }, [value, spring]);

  return (
    <motion.span
      className={cn(
        'font-mono font-bold tabular-nums',
        size === 'sm' && 'text-lg',
        size === 'md' && 'text-2xl',
        size === 'lg' && 'text-3xl',
        size === 'xl' && 'text-4xl',
        className
      )}
    >
      {prefix}
      <motion.span>{display}</motion.span>
      {suffix}
    </motion.span>
  );
}
```

Key features:
- Spring-animated transitions between values
- Customizable decimal places
- Prefix/suffix support (e.g., "$", "%")
- Size variants
  </action>
  <verify>Value animates smoothly when changed, no flicker</verify>
  <done>AnimatedValue with spring physics for smooth number transitions.</done>
</task>

<task type="auto">
  <name>Task 3: Create FlowArrow and Entity components</name>
  <files>src/components/visualizations/FlowArrow.tsx, src/components/visualizations/Entity.tsx, src/components/visualizations/index.ts, src/types/index.ts</files>
  <action>
Create FlowArrow for showing money/data flow:

```typescript
// src/components/visualizations/FlowArrow.tsx
'use client';

import { motion } from '@/lib/motion';
import { cn } from '@/lib/utils';

interface FlowArrowProps {
  direction?: 'right' | 'left' | 'up' | 'down';
  animated?: boolean;
  label?: string;
  value?: string;
  className?: string;
}

export function FlowArrow({
  direction = 'right',
  animated = true,
  label,
  value,
  className,
}: FlowArrowProps) {
  const rotation = {
    right: 0,
    down: 90,
    left: 180,
    up: 270,
  }[direction];

  return (
    <div
      className={cn(
        'flex items-center gap-2',
        direction === 'up' || direction === 'down' ? 'flex-col' : 'flex-row',
        className
      )}
    >
      {label && (
        <span className="text-xs text-text-muted whitespace-nowrap">{label}</span>
      )}
      <div className="relative" style={{ transform: `rotate(${rotation}deg)` }}>
        <svg width="60" height="24" viewBox="0 0 60 24" className="text-primary-500">
          <defs>
            <marker
              id="arrowhead"
              markerWidth="10"
              markerHeight="7"
              refX="9"
              refY="3.5"
              orient="auto"
            >
              <polygon points="0 0, 10 3.5, 0 7" fill="currentColor" />
            </marker>
          </defs>
          <line
            x1="0"
            y1="12"
            x2="50"
            y2="12"
            stroke="currentColor"
            strokeWidth="2"
            markerEnd="url(#arrowhead)"
          />
          {animated && (
            <motion.circle
              cx="0"
              cy="12"
              r="4"
              fill="currentColor"
              animate={{ cx: [0, 45, 0] }}
              transition={{ repeat: Infinity, duration: 2, ease: 'easeInOut' }}
            />
          )}
        </svg>
      </div>
      {value && (
        <span className="text-sm font-semibold text-primary-500">{value}</span>
      )}
    </div>
  );
}
```

Create Entity for representing institutions/accounts:

```typescript
// src/components/visualizations/Entity.tsx
'use client';

import { motion } from '@/lib/motion';
import { cn } from '@/lib/utils';

interface EntityProps {
  icon: string;
  label: string;
  value?: string;
  subtext?: string;
  highlighted?: boolean;
  onClick?: () => void;
  className?: string;
}

export function Entity({
  icon,
  label,
  value,
  subtext,
  highlighted = false,
  onClick,
  className,
}: EntityProps) {
  return (
    <motion.div
      whileHover={{ scale: 1.02 }}
      whileTap={onClick ? { scale: 0.98 } : undefined}
      onClick={onClick}
      className={cn(
        'p-4 rounded-xl text-center transition-colors',
        'bg-surface-1 border',
        highlighted
          ? 'border-primary-500 shadow-lg shadow-primary-500/10'
          : 'border-surface-2',
        onClick && 'cursor-pointer',
        className
      )}
    >
      <span className="text-3xl block mb-2">{icon}</span>
      <div className="text-sm font-medium text-text-primary">{label}</div>
      {value && (
        <div className="text-lg font-bold text-primary-500 mt-1">{value}</div>
      )}
      {subtext && (
        <div className="text-xs text-text-muted mt-1">{subtext}</div>
      )}
    </motion.div>
  );
}
```

Create barrel export:

```typescript
// src/components/visualizations/index.ts
export { Slider } from './Slider';
export { AnimatedValue } from './AnimatedValue';
export { FlowArrow } from './FlowArrow';
export { Entity } from './Entity';
```

Add visualization types to src/types/index.ts:

```typescript
// Add to existing types
export interface VisualizationState {
  [key: string]: number;
}
```
  </action>
  <verify>All components render, FlowArrow animates, Entity shows hover state</verify>
  <done>FlowArrow with animated dot, Entity with highlight state, barrel export, types added.</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run dev` starts without errors
- [ ] `npm run build` succeeds
- [ ] Slider updates value in real-time with animation
- [ ] AnimatedValue smoothly transitions between numbers
- [ ] FlowArrow shows animated flowing dot
- [ ] Entity shows hover/highlighted states
- [ ] All components exported from barrel file
</verification>

<success_criteria>
- All tasks completed
- Base visualization components are reusable primitives
- Instant feedback achieved (animations feel immediate)
- Components follow glass morphism design language
</success_criteria>

<output>
After completion, create `.planning/phases/04-interactive-visualizations/04-01-SUMMARY.md`
</output>
