---
phase: 09-module-4-regulation
plan: 04
type: execute
wave: 3
depends_on: ["09-01"]
files_modified:
  - src/components/visualizations/diagrams/StressTestSimulator.tsx
  - src/components/visualizations/diagrams/TBTFConcentration.tsx
  - src/components/visualizations/diagrams/index.ts
autonomous: true
---

<objective>
Build two visualization components for Lessons 4-2.3 and 4-3.1: Stress Test Simulator and TBTF Bank Concentration/G-SIB visualization.

Purpose: Create interactive visualizations for stress testing mechanics and Too Big to Fail dynamics.
Output: Two new diagram components registered in the visualizations barrel export.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

@src/components/visualizations/diagrams/VaRDistribution.tsx
@src/components/visualizations/diagrams/BankTypesPyramid.tsx
@src/components/visualizations/diagrams/index.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create StressTestSimulator component</name>
  <files>src/components/visualizations/diagrams/StressTestSimulator.tsx</files>
  <action>
  Create an interactive stress test simulator showing how regulators test bank resilience.

  Design: Multi-step interactive simulation.

  **Step 1 — Scenario Selection:**
  Three scenario tabs (like existing scenario selector pattern):
  - Baseline: GDP +2.5%, Unemployment 4%, House prices +3%, Market +8%
  - Adverse: GDP -1%, Unemployment 7%, House prices -5%, Market -15%
  - Severely Adverse: GDP -5%, Unemployment 10%, House prices -25%, Market -40%
  - Show scenarios as a visual severity meter (green → amber → red)
  - Each scenario displays its macro variables in a clean grid

  **Step 2 — Bank Capital Impact:**
  - Start with a bank's initial capital ratio (e.g., 12%)
  - Animated waterfall showing:
    - Starting capital ratio: 12%
    - Projected loan losses: -X% (varies by scenario)
    - Revenue offset: +Y%
    - Resulting capital ratio: Z%
    - Minimum threshold line at 4.5% (red dashed)
  - Color: green if passes, red if fails
  - Animate the waterfall bars dropping/rising with spring physics

  **Step 3 — Results Panel:**
  - Pass/Fail banner with animation
  - Show three example banks (like SCAP results):
    - "MegaBank" — passes all scenarios
    - "Regional Bank" — passes baseline/adverse, barely passes severely adverse
    - "Troubled Bank" — fails severely adverse
  - Consequence text: "Failed banks must raise capital or restrict dividends"

  **SCAP vs CCAR comparison box:**
  - Small info card distinguishing:
    - SCAP (2009): One-time, 19 banks, crisis response
    - CCAR (annual): Ongoing, largest banks, 3 scenarios, public results
  - Key insight: "Public results → market discipline"

  Follow existing patterns: scenario selector (like RiskReturnTradeoff scenarios), waterfall (like IncomeStatementWaterfall), spring animations, glass morphism.
  </action>
  <verify>npm run build succeeds without errors</verify>
  <done>StressTestSimulator renders three scenario tabs with animated capital waterfall, pass/fail indicators, and SCAP/CCAR comparison.</done>
</task>

<task type="auto">
  <name>Task 2: Create TBTFConcentration component</name>
  <files>src/components/visualizations/diagrams/TBTFConcentration.tsx, src/components/visualizations/diagrams/index.ts</files>
  <action>
  Create an interactive visualization showing bank concentration, systemic risk, and the G-SIB framework.

  Design: Three-section layout.

  **Section 1 — Bank Concentration Bar Chart:**
  - Horizontal stacked bar showing US banking system:
    - Top ~10 megabanks: ~50% of assets (labeled: JPMorgan, BofA, Citi, Wells Fargo, etc.)
    - Mid-size banks: ~35% of assets
    - Small/community banks (thousands): ~15% of assets
  - Animate bars expanding on mount
  - Color gradient from dark (mega) to light (small)
  - Key insight: "Few banks hold most assets"

  **Section 2 — Why Megabanks Exist (Toggle):**
  Two views toggling:
  - "Efficiency View": Economies of scale + scope (shared infrastructure, global services)
  - "Subsidy View": Grow to become TBTF → implicit guarantee → lower funding costs
  - Visual: Efficiency shows cost curve declining with size
  - Visual: Subsidy shows "Expected bailout → Lower risk → Cheaper funding" chain

  **Section 3 — G-SIB Bucket System:**
  - Visual tier/ladder showing G-SIB buckets:
    - Bucket 5 (highest): empty (reserved)
    - Bucket 4: +3.5% surcharge
    - Bucket 3: +2.5% surcharge (JPMorgan)
    - Bucket 2: +2.0% surcharge
    - Bucket 1: +1.5% surcharge
  - Each bucket shows bank names (approximate examples)
  - Five assessment factors displayed as icons:
    - Size, Interconnectedness, Complexity, Global activity, Substitutability
  - Policy logic at bottom: "Higher systemic footprint → Higher capital buffer → Lower failure probability"

  **Systemic Risk Formula:**
  - Display: Spillover Size ∝ Bank Size × Interconnectedness
  - Display: Required Capital = Base Requirement + Systemic Surcharge

  Follow existing patterns (BankTypesPyramid for tiered visual). Use spring animations, glass morphism, Tailwind.

  **Update diagrams/index.ts:**
  Add exports for StressTestSimulator and TBTFConcentration.
  </action>
  <verify>npm run build succeeds without errors</verify>
  <done>TBTFConcentration renders bank concentration chart, efficiency/subsidy toggle, and G-SIB bucket system. StressTestSimulator and TBTFConcentration exported from diagrams/index.ts.</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] npm run build succeeds
- [ ] StressTestSimulator renders scenario selection, capital waterfall, and results
- [ ] TBTFConcentration renders concentration chart, toggle views, and G-SIB buckets
- [ ] Both components exported from diagrams/index.ts
</verification>

<success_criteria>
- All tasks completed
- Both visualization components working with interactive elements
- Animations are smooth and engaging
- Consistent with existing design patterns
</success_criteria>

<output>
After completion, create `.planning/phases/09-module-4-regulation/09-04-SUMMARY.md`
</output>
